// Firebase Firestore Security Rules for Smart Roll Call
// This file contains recommended security rules for the Firebase project

rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // Users can only access their own data
    match /users/{userId} {
      allow read, write: if request.auth != null && request.auth.uid == userId || userId == 'public_user';
      
      // Batches collection
      match /batches/{batchId} {
        allow read, write: if request.auth != null && request.auth.uid == userId || userId == 'public_user';
        
        // Students in batches
        match /students/{studentId} {
          allow read, write: if request.auth != null && request.auth.uid == userId || userId == 'public_user';
          
          // Attendance records
          match /attendance/{attendanceId} {
            allow read, write: if request.auth != null && request.auth.uid == userId || userId == 'public_user';
          }
        }
      }
    }
    
    // ESP32 Integration Rules
    // Allow ESP32 to read student MAC addresses and write attendance
    match /users/public_user/batches/{batchId}/students/{studentId} {
      // ESP32 can read student data to find MAC addresses
      allow read: if true; // In production, you might want to add API key validation
      
      match /attendance/{date} {
        // ESP32 can write attendance records
        allow create, update: if true; // In production, add proper validation
      }
    }
  }
}